/*!
 * ImgPreviewer v1.0.4
 * https://github.com/yue1123/img-previewer
 *
 * Copyright 2021-present dh
 * Released under the MIT license
 *
 * Date: 2021-05-05T13:48:45.677Z
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).ImgPreviewer=t()}(this,(function(){"use strict";function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(e,t){var n=null;return function(i){clearTimeout(n),n=setTimeout((function(){e(i),clearTimeout(n)}),t)}}function i(e){e.preventDefault()}function o(e,t,n){var i=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,o=window.cancelAnimationFrame||window.mozCancelAnimationFrame,s=t.start||0,a=t.end||0,c=t.step,l=null;!function d(){c>0&&s<a||c<0&&s>a?(s+=c,e.style[t.style]=t.template.replace("$",s),l=i(d)):(n&&n(),o(l))}()}function s(e,t,n){var i=u*n/e,o=r*n/t;return i>o?o:i}function a(e,t,n,i,o){e.style.cssText="width:".concat(t,"px;height:").concat(n,"px;position:fixed; top:").concat(o,"px; left:").concat(i,"px;")}function c(e){m.style.display=e?"block":"none"}function l(e){d.style.overflow=e?"auto":"hidden"}var d,r,u,m=null,h=null,f=null,g=0,p={ratio:.9,zoom:{min:.1,max:5,step:.1},opacity:.6,scrollbar:!0};return function(){function v(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(e(this,v),this.index=0,this.selector=t,this.options=n,this.imageElements=[],n.zoom=Object.assign({},p.zoom,n.zoom||{}),this.config=Object.assign({},p,n),!t||"string"!=typeof t)throw new Error("ImagePreviewer plugin should css string selector that on first params,like #el,.el");var i=document.querySelector(t);if(!i)throw new Error("selector is invalid");this.init()}var y,w,x;return y=v,x=[{key:"setImageAnimationParams",value:function(e){h.style.setProperty("--offsetX","".concat(e.endX,"px")),h.style.setProperty("--offsetY","".concat(e.endY+30,"px")),h.style.setProperty("--scale","".concat(e.scale)),h.style.setProperty("--rotate","".concat(e.rotate,"deg"))}}],(w=[{key:"update",value:function(){var e=this;this.imageElements=document.querySelectorAll("".concat(this.selector," img:not(#preview-image)")),this.imageElements.forEach((function(t,n){t.onclick=null,t.onclick=function(t){e.handleOpen(t,n),c(!0),e.updateIndex(n)}}))}},{key:"bindEvent",value:function(){var e=this,t=/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(window.navigator.userAgent),o=t?"touchstart":"mousedown",s=t?"touchend":"mouseup",a=t?"touchmove":"mousemove";this.imageElements.forEach((function(t,n){t.onclick=function(t){e.handleOpen(t,n),c(!0),e.updateIndex(n)}})),document.getElementById("close").addEventListener("click",(function(){e.handleClose()})),document.getElementById("reset").addEventListener("click",(function(){e.handleReset()})),document.getElementById("prev").addEventListener("click",(function(){e.prev()})),document.getElementById("next").addEventListener("click",(function(){e.next()})),m.addEventListener("click",(function(t){"image-container"===t.target.classList[0]&&e.handleClose()})),h.addEventListener(o,(function(e){var t=e.clientX-h.offsetLeft,n=e.clientY-h.offsetTop;this.classList.add("moving"),this["on".concat(a)]=function(e){var i=e.clientX-t,o=e.clientY-n;this.style.left="".concat(i,"px"),this.style.top="".concat(o,"px")},this["on".concat(s)]=function(){this.classList.remove("moving"),this.onmousemove=null},this.onmouseout=function(){this.classList.remove("moving"),this.onmousemove=null}})),h.addEventListener("mousewheel",(function(t){var n=e.config.zoom,i=n.min,o=n.max,s=n.step;t.wheelDelta>0&&g<o?g+=s:g>i&&(g-=s),h.style.setProperty("--scale","".concat(g.toFixed(2)))}),!0),document.getElementById("rotate-right").addEventListener("click",(function(){e.handelRotateRight()})),document.getElementById("rotate-left").addEventListener("click",(function(){e.handelRotateLeft()})),m.addEventListener("mousewheel",i),document.ondragstart=i,document.ondragend=i,window.onresize=n.bind(null,(function(){e.handleClose(),u=window.innerWidth,r=window.innerHeight}),100)()}},{key:"handleReset",value:function(){h.style.top="".concat(f.startY,"px"),h.style.left="".concat(f.startX,"px"),h.style.setProperty("--rotate","".concat(0,"deg")),h.style.setProperty("--scale","".concat(f.scale)),f.rotate=0}},{key:"handleOpen",value:function(e,t){var n=this.config.ratio,i=this.imageElements,o=e.target,c=o.width,d=o.height,p=e.clientX-e.offsetX,y=e.clientY-e.offsetY+1;g=s(c,d,n),f={startX:p,startY:y,endX:u/2-c/2-p,endY:r/2-d/2-y,scale:g,rotate:0},h.src=i[t].src,a(h,c,d,p,y),setTimeout((function(){v.setImageAnimationParams(f)})),m.classList.add("show"),!this.config.scrollbar&&l(!1)}},{key:"handleClose",value:function(){var e,t,n,i,s,a=this.config.opacity,d=this.imageElements[this.index];if(e=d,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight,n=e.offsetTop,i=e.offsetHeight,s=document.documentElement.scrollTop,i+n>s&&n-s<=t+100){o(m,{start:a,end:0,step:-.02,style:"background",template:"rgba(0, 0, 0, $)"},(function(){h.style="",h.src="",m.style.background="",m.classList.remove("hiding"),c(!1)}));var r=function(e){return e.getBoundingClientRect()}(d),u=r.top,f=r.left,g=r.width,p=r.height;h.style.cssText="width:".concat(g,"px;height:").concat(p,"px;position: fixed; top: ").concat(u,"px; left: ").concat(f,"px;")}else h.style.display="none",o(m,{start:a,end:0,step:-.05,style:"background",template:"rgba(0, 0, 0, $)"},(function(){h.src="",h.style="",m.style="",m.classList.remove("hiding"),c(!1)}));m.classList.remove("show"),m.classList.add("hiding"),!this.config.scrollbar&&l(!0)}},{key:"handelRotateLeft",value:function(){f.rotate-=90,h.style.setProperty("--rotate","".concat(f.rotate,"deg"))}},{key:"handelRotateRight",value:function(){f.rotate+=90,h.style.setProperty("--rotate","".concat(f.rotate,"deg"))}},{key:"prev",value:function(){0!==this.index&&(this.index-=1,this.updateIndex(this.index),this.useIndexUpdateImage(this.index))}},{key:"next",value:function(){this.index<this.imageElements.length-1&&(this.index+=1,this.updateIndex(this.index),this.useIndexUpdateImage(this.index))}},{key:"useIndexUpdateImage",value:function(e){var t=this.config.ratio,n=this.imageElements[e],i=n.height,o=n.width,c=n.src;h.classList.add("moving"),a(h,o,i,u/2-o/2,r/2-i/2),f={endX:0,endY:0,scale:s(o,i,t),rotate:0},h.src=c,v.setImageAnimationParams(f),setTimeout((function(){h.classList.remove("moving")}))}},{key:"updateIndex",value:function(e){this.index=e,document.getElementById("total-nums").innerText=this.imageElements.length,document.getElementById("current-index").innerText=e+1}},{key:"render",value:function(){var e=document.getElementById("image-preview-container");e?m=e:((m=document.createElement("div")).classList.add("image-preview-container"),m.id="image-preview-container",m.innerHTML='<div class="preview-header">\n                        <div class="nums">\n\n                            <p>\n                                <span id="current-index"></span>\n                                &nbsp;/&nbsp;\n                                <span id="total-nums"></span>\n                            </p>\n\n                        </div>\n                        <div class="tool-btn">\n                            <button id="rotate-left" data-tooltip="Rotate Right"><i class="iconfont icon-xuanzhuan"></i></button>\n                            <button id="rotate-right" data-tooltip="Rotate Left"><i class="iconfont icon-xuanzhuan1"></i></button>\n                            <button id="reset" data-tooltip="Reset"><i class="iconfont icon-zhongzhi"></i></button>\n                            <button id="close" data-tooltip="Close"><i class="iconfont icon-account-practice-lesson-close"></i></button>\n                        </div>\n                    </div>\n                    <div class="image-container">\n                        <button id="prev" data-tooltip="Prev"><i class="iconfont icon-shangyige"></i></button>\n                        <div class="img-content" id="image-content"><img id="preview-image" src="" alt="" /></div>\n                        <button id="next" data-tooltip="Next"><i class="iconfont icon-xiayige"></i></button>\n                    </div>',d.appendChild(m)),h=document.getElementById("preview-image")}},{key:"init",value:function(){d=document&&document.body||document.getElementsByTagName("body")[0],u=window.innerWidth,r=window.innerHeight,this.imageElements=document.querySelectorAll("".concat(this.selector," img"));for(var e=0,t=this.imageElements.length;e<t;e++)this.imageElements[e].classList.add("zoom-in");this.render(),this.updateIndex(this.index),this.bindEvent(this.imageElements),this.options.onInited&&this.options.onInited()}}])&&t(y.prototype,w),x&&t(y,x),v}()}));
